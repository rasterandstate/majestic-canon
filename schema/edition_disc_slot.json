{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://majestic.canon/schema/edition-disc-slot",
  "title": "Edition Disc Slot",
  "description": "Single disc slot in edition.discs[index]",
  "type": "object",
  "properties": {
    "format": {
      "type": "string",
      "description": "BLURAY, DVD, UHD, OTHER"
    },
    "region": {
      "type": "string"
    },
    "role": {
      "type": "string"
    },
    "disc_type": {
      "type": "string",
      "enum": [
        "dvd",
        "bluray",
        "uhd"
      ],
      "description": "From fingerprint identity.type only. Never inferred from format."
    },
    "disc_count": {
      "type": "number",
      "default": 1
    },
    "disc_identity": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Identity type from fingerprint (e.g. majestic.optical-disc.dvd)"
        },
        "structural_hash": {
          "type": "string"
        },
        "cas_hash": {
          "type": "string"
        },
        "hash_algorithm": {
          "type": "string"
        },
        "version": {
          "type": "number"
        },
        "generated_at": {
          "type": "string"
        },
        "fingerprinted_at": {
          "type": "string"
        },
        "last_verified_at": {
          "type": "string",
          "description": "ISO timestamp of last physical verification (idempotent re-fingerprint)"
        },
        "verification_count": {
          "type": "integer",
          "description": "Number of successful idempotent verifications. Enables trust scoring and disc stability metrics."
        }
      }
    },
    "fingerprint_history": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/fingerprint_history_entry"
      },
      "description": "Previous fingerprints when overwritten. Full provenance. Do not lose historical fingerprints."
    },
    "region_history": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/region_history_entry"
      },
      "description": "Previous region values when corrected by fingerprint. Disc is authoritative."
    }
  },
  "$defs": {
    "disc_identity": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        },
        "structural_hash": {
          "type": "string"
        },
        "cas_hash": {
          "type": "string"
        },
        "hash_algorithm": {
          "type": "string"
        },
        "version": {
          "type": "number"
        },
        "generated_at": {
          "type": "string"
        },
        "fingerprinted_at": {
          "type": "string"
        },
        "last_verified_at": {
          "type": "string"
        },
        "verification_count": {
          "type": "integer"
        }
      }
    },
    "fingerprint_history_entry": {
      "type": "object",
      "required": [
        "structural_hash",
        "cas_hash",
        "hash_algorithm",
        "fingerprinted_at",
        "reason"
      ],
      "properties": {
        "type": {
          "type": "string"
        },
        "version": {
          "type": "number"
        },
        "structural_hash": {
          "type": "string"
        },
        "cas_hash": {
          "type": "string"
        },
        "hash_algorithm": {
          "type": "string"
        },
        "fingerprinted_at": {
          "type": "string"
        },
        "reason": {
          "type": "string",
          "enum": [
            "overwrite",
            "algorithm_upgrade",
            "manual_correction"
          ]
        }
      }
    },
    "region_history_entry": {
      "type": "object",
      "required": ["previous", "corrected_to", "corrected_at", "reason"],
      "properties": {
        "previous": { "type": "string" },
        "corrected_to": { "type": "string" },
        "corrected_at": { "type": "string", "description": "ISO timestamp" },
        "reason": { "type": "string", "enum": ["fingerprint"] }
      }
    }
  }
}