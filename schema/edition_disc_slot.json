{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://majestic.canon/schema/edition-disc-slot",
  "title": "Edition Disc Slot",
  "description": "Single disc slot in edition.discs[index]. Slot is 1-indexed. Role is explicit metadata. For legacy: slot defaults to index+1, role to 'unknown'.",
  "type": "object",
  "properties": {
    "slot": {
      "type": "integer",
      "minimum": 1,
      "description": "1-indexed physical slot. Required for new editions. Legacy: inferred from array index."
    },
    "format": {
      "type": "string",
      "description": "BLURAY, DVD, UHD, OTHER"
    },
    "role": {
      "type": "string",
      "enum": [
        "feature",
        "feature_sd_copy",
        "bonus",
        "soundtrack",
        "unknown"
      ],
      "default": "unknown",
      "description": "Explicit disc role. Never inferred. Default 'unknown' for legacy."
    },
    "region": {
      "type": "string"
    },
    "disc_type": {
      "type": "string",
      "enum": [
        "dvd",
        "bluray",
        "uhd"
      ],
      "description": "From fingerprint identity.type only. Never inferred from format."
    },
    "disc_count": {
      "type": "number",
      "default": 1
    },
    "disc_identity": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Identity type from fingerprint (e.g. majestic.optical-disc.dvd)"
        },
        "structural_hash": {
          "type": "string"
        },
        "cas_hash": {
          "type": "string"
        },
        "hash_algorithm": {
          "type": "string"
        },
        "version": {
          "type": "number"
        },
        "generated_at": {
          "type": "string"
        },
        "fingerprinted_at": {
          "type": "string"
        },
        "last_verified_at": {
          "type": "string",
          "description": "ISO timestamp of last physical verification (idempotent re-fingerprint)"
        },
        "verification_count": {
          "type": "integer",
          "description": "Number of successful idempotent verifications. Enables trust scoring and disc stability metrics."
        }
      }
    },
    "fingerprint_history": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/fingerprint_history_entry"
      },
      "description": "Previous fingerprints when overwritten. Full provenance. Do not lose historical fingerprints."
    },
    "region_history": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/region_history_entry"
      },
      "description": "Previous region values when corrected by fingerprint. Disc is authoritative."
    },
    "variant": {
      "type": "object",
      "description": "Optional variant metadata for disambiguation. Not identity-significant.",
      "properties": {
        "video_type": {
          "type": "string",
          "enum": [
            "2D",
            "3D",
            "both"
          ]
        },
        "content_scope": {
          "type": "string",
          "enum": [
            "feature",
            "bonus",
            "mixed"
          ]
        },
        "duplicate_of_disc": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 1,
          "description": "1-indexed slot this disc duplicates. Cannot reference self."
        },
        "notes": {
          "type": "string"
        }
      }
    }
  },
  "$defs": {
    "disc_identity": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string"
        },
        "structural_hash": {
          "type": "string"
        },
        "cas_hash": {
          "type": "string"
        },
        "hash_algorithm": {
          "type": "string"
        },
        "version": {
          "type": "number"
        },
        "generated_at": {
          "type": "string"
        },
        "fingerprinted_at": {
          "type": "string"
        },
        "last_verified_at": {
          "type": "string"
        },
        "verification_count": {
          "type": "integer"
        }
      }
    },
    "fingerprint_history_entry": {
      "type": "object",
      "required": [
        "structural_hash",
        "cas_hash",
        "hash_algorithm",
        "fingerprinted_at",
        "reason"
      ],
      "properties": {
        "type": {
          "type": "string"
        },
        "version": {
          "type": "number"
        },
        "structural_hash": {
          "type": "string"
        },
        "cas_hash": {
          "type": "string"
        },
        "hash_algorithm": {
          "type": "string"
        },
        "fingerprinted_at": {
          "type": "string"
        },
        "reason": {
          "type": "string",
          "enum": [
            "overwrite",
            "algorithm_upgrade",
            "manual_correction"
          ]
        }
      }
    },
    "region_history_entry": {
      "type": "object",
      "required": [
        "previous",
        "corrected_to",
        "corrected_at",
        "reason"
      ],
      "properties": {
        "previous": {
          "type": "string"
        },
        "corrected_to": {
          "type": "string"
        },
        "corrected_at": {
          "type": "string",
          "description": "ISO timestamp"
        },
        "reason": {
          "type": "string",
          "enum": [
            "fingerprint"
          ]
        }
      }
    }
  }
}